<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">

		<meta name="viewport" content="width=device-width, initial-scale=1">
			
		<!-- Titulo de la empresa -->
		<title>GIFStore</title>

		<!-- Google Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,700" rel="stylesheet">
		
		<!-- Bootstrap -->
		<link type="text/css" rel="stylesheet" href="css/bootstrap.min.css"/>

		<!-- Font Awesome Icon -->
		<link rel="stylesheet" href="css/font-awesome.min.css">

		<!-- Hoja de estilo personalizada -->
		<link type="text/css" rel="stylesheet" href="css/custom.css"/>
    </head>
	<body>
		<!-- HEADER -->
		<header>
			<div id="encabezado-superior">
				<div class="container">
					<ul class="header-links pull-left">
						<li><a><i class="fa fa-phone"></i> +521 1433-2593</a></li>
						<li><a href="https://goo.gl/maps/N4Cdk8s9FdN2"><i class="fa fa-map-marker"></i> Calle Nueva Escocia 1885, Providencia 5a Sección, 44638 Guadalajara, Jal.</a></li>
					</ul>
					<!-- Inventario -->
					<ul class="header-links pull-right" id='ulInventario'>
						<li><a href="inventario.html"><i class="fa fa-user-o"></i>Inventario</a></li>
					</ul>
					<!-- AdminUser -->
					<ul class="header-links pull-right" id='ulAdmin'>
						<li><a href="agredarusuarios.html"><i class="fa fa-user-o"></i> AdministradorUsuario</a></li>
					</ul>
					<!-- Registro -->
					<ul class="header-links pull-right" id='ulIniciar'>
						<li><a href="usuario.html"><i class="fa fa-user-o"></i>Registar</a></li>
					</ul>
					<ul class="header-links pull-right" id='ulCuenta' onclick="mostrarCash()">
							<!-- <li onclick="mostrar()"><a href="#"><i class="fa fa-user-circle"  data-toggle="popover" data-placement="bottom" data-content="Soy un popover"></i>Cuenta</a></li> -->
						   <li> <a  href='#' class="danger"  data-placement='bottom' title ='<center> <h5  id="etiquetaNombreUsuario"> Nombre usuario</h5> </center>' >  <i class='fa fa-user-circle'> </i>Cuenta</a> </li>
							<div id="popover_content_wrapper" style="display: none">
							
							<div>
								<center>
								<h5 id="etiquetaCash">Tu cash es de: xx</h5>
								</center>
								<div> <center> <button onclick="mostrarCompras()"> Mis compras <i class="fa fa-shopping-bag" aria-hidden="true"></i> </button> </center>  </div>
								<div id="separa"> </div>
								<div> <center> <button onclick="cerrarS()" id="cerrarS" type="submit"> Cerrar sesion <i class="fa fa-sign-out" aria-hidden="true"></i> </button> </center>  </div>
							</div>
							</div>
						</ul>
				</div>
			</div>

			<div id="header">
				<div class="container">
					<div class="row">
						<div class="col-md-3">
							<div class="header-logo">
								<a href="index.html" class="logo">
									<img src="./img/icon.png" alt="Logo TEM Store" width="97" height="110">
									GIFSTORE&#174;
								</a>
							</div>
						</div>

					

						<!-- USUARIO -->
						<div class="col-md-3 clearfix">
							<div class="header-ctn">
							

								<!-- Menu Toogle -->
								<div class="menu-toggle">
									<a href="#">
										<i class="fa fa-bars"></i>
										<span>Menu</span>
									</a>
								</div>
								<!-- /Menu Toogle -->
							</div>
						</div>
						<!-- /USUARIO-->
					</div>
				</div>
			</div>
		</header>
		<!-- /HEADER -->

		<!--<nav id="navigation">
			<div class="container">
				<div id="responsive-nav">
					<ul class="main-nav nav navbar-nav">
						<li class="active"><a href="index.html">Inicio</a></li>
						<li><a href="tazas.html">Tazas</a></li>
						<li><a href="camisas.html">Camisas</a></li>
						<li><a href="llaveros.html">Llaveros</a></li>
						<li><a href="cachuchas.html">Cachuchas</a></li>
					</ul>
				</div>
			</div>
		</nav>-->

		<!-- USUARIO -->
		<div class="contenedor-formulario">
			<div class="formulario-ingreso">
			
					
					<!-- Subir imagen -->
					
					<div class="imagen-usuario">
						<img src="img/imagen.png" alt="AVATAR">
					</div>
					
					<div>
					<center>
					<input id="btnimagen" type="file"
						   accept=".jpg" required>
					</center>
					</div>
					
					

					<span class="titulo-ingreso">
						Agregar Producto
				  </span>
					<!-- AdminUser -->

				
					<div class="campo-texto" data-validate = "Nombre requerido">
						<input  id="productNameInput" class="input-ingreso" type="text" name="usuario" placeholder="nombreProducto">
						<span></span>
					</div>
					<!-- AdminUser -->
					<center>
					<div  class="campo-texto" data-validate = "Categorias"><span></span>
					  <select id="productCategoryInput" name="select" class="input-select">
					    <option value="0">Categorías</option>
					    <option value="4">Tazas</option>
					    <option value="2">Camisas</option>
					    <option value="3">Llaveros</option>
					    <option value="1">Cachuchas</option>
				      </select>
					</div>
					</center>
					<!-- AdminUser -->
					
					<div class="campo-texto" data-validate = "Nombre requerido">
						<input  id="productPriceInput" class="input-ingreso" type="text" name="usuario" placeholder="Precio">
						<span></span>
					</div>

					<div class="campo-texto" data-validate = "Nombre requerido">
						<input  id="productStockInput" class="input-ingreso" type="text" name="usuario" placeholder="Stock">
						<span></span>
					</div>
					

				  <div>
						<button id="crearProductoBtn" class="boton-ingresar">
							Agregar
					</button>
					</div>

				
			</div>
		</div>

		<!-- /USUARIO -->

		<!-- FOOTER -->
		<footer id="footer">
			<div class="section">
				<!-- container -->
				<div class="container">
					<!-- row -->
					<div class="row">
						<div class="col align-self-center">
							<div class="footer">
								<h3 class="footer-title">Sobre Nosotros</h3>
								<p>Nos dedicamos a ofrecerte los mejores regalos al mejor precio. Contamos con
								sistema de pedidos hacia proveedores en linea.</p>
								<ul class="footer-links">
									<li><a href="mapa.html"><i class="fa fa-map-marker"></i>Calle Nueva Escocia 1885, Providencia 5a Sección, 44638 Guadalajara, Jal.</a></li>
									<li><a><i class="fa fa-phone"></i>+521 1433-2593</a></li>
								</ul>
							</div>
						</div>
					<!-- /row -->
				</div>
				<!-- /container -->
			</div>
			<div id="bottom-footer" class="section">
				<div class="container">
					<div class="row">
						<div class="col-md-12 text-center">
							<span class="copyright">
								Copyright &copy; 2019 Todos los derechos reservados. | 8B2
							</span>
						</div>
					</div>
				</div>
			</div>
		</footer>
		<!-- /FOOTER -->
		<script>
			//SAUL CREATE PRODUCT CODE!!!
			getUserToken();
			getUserType();
			mostrarBarraTipoUsuario();
			$('.danger').popover({ 
				html : true,
				content: function() {
				return $('#popover_content_wrapper').html();
				}
			});


			function sendCreateProductRequest(imgArray,nombreProducto,nombreImagen,precio,Stock,categoria)
			{
			var xhr = new XMLHttpRequest()
			xhr.open("POST","http://localhost:3000/ProductSelling/CreateProduct")
			xhr.setRequestHeader("Content-Type","application/json")
			xhr.send(JSON.stringify({name:nombreProducto,imgName:nombreImagen,price:precio,stock:Stock,category:Number(categoria),imgData:imgArray}))
			xhr.onreadystatechange = function() 
			{
			if (this.readyState == 4 && this.status == 200)
				{
					alert(this.responseText)
				}
			}
			
			}

			async function readSingleFile(e) 
			{
				return new Promise(async(resolve,reject)=>
				{
					var file = e
					if (!file) {
					return;
					}
					var reader = new FileReader();
					reader.onload = function(e) {
					var contents = e.target.result;
				
					var arrayOfPixels = new Uint8Array(contents);
					var array = Array.from(arrayOfPixels)
					resolve(array)
					
					};
					reader.readAsArrayBuffer(file);
				})		
			}

			async function submitCreateProductData(event)
			{
				var archivoImg =  document.getElementById('btnimagen').files[0];
				var nombreProducto = $("#productNameInput").val();
				var category = $("#productCategoryInput").val();
				var stockProducto = $("#productStockInput").val();
				var precioProducto = $("#productPriceInput").val();

				//console.debug(archivoImg)
				console.log("nombre         "+nombreProducto);
				console.log("category       "+category);
				console.log("stockProducto  "+stockProducto);
				console.log("precioProducto "+precioProducto);
				
				var imageArrayData;
				try {
					imageArrayData= await readSingleFile(archivoImg);
				} catch (error) {
					console.log(error);
				}
			
				
				sendCreateProductRequest(imageArrayData,nombreProducto,archivoImg.name,precioProducto,stockProducto,category);
				//sendImage(files);
			};
			try {
				document.getElementById("crearProductoBtn").onclick =  submitCreateProductData
			} catch (error) {
				alert(error)
			}
			
			</script>

		<script src="js/Globales.js"></script>
		<script src="js/jquery.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<!-- <script src="js/index.js"></script> -->

	</body>
</html>
